Dmin=mean(Dmin, na.rm=T),
Dmax=mean(Dmax, na.rm=T)
)
Com.Sp.mean.ht <- Com.Sp.mean %>% left_join(Com.Sp.hts, by=c('Observation_Label'='Observation_Label', 'Species'='AcTaxon', 'Simple'='Simple'))
#ensure not to exceed 100%
Com.Sp.mean.ht$Field <- ifelse(Com.Sp.mean.ht$Field > 100,100,Com.Sp.mean.ht$Field)
Com.Sp.mean.ht$Shrub <- ifelse(Com.Sp.mean.ht$Shrub > 100,100,Com.Sp.mean.ht$Shrub)
Com.Sp.mean.ht$Subcanopy <- ifelse(Com.Sp.mean.ht$Subcanopy > 100,100,Com.Sp.mean.ht$Subcanopy)
Com.Sp.mean.ht$Tree <- ifelse(Com.Sp.mean.ht$Tree > 100,100,Com.Sp.mean.ht$Tree)
#average overstory and understory
Com.Sp.mean.ht$Total <- 100*(1-10^(apply(log10(1-(Com.Sp.mean.ht[,c('Field', 'Shrub', 'Subcanopy', 'Tree')]/100.001)), MARGIN = 1, FUN='sum')))
Com.Sp.mean.ht <-subset(Com.Sp.mean.ht, !substr(Species,1,1) %in% '-'& !Species %in% '')
##cluster derived phases ----
groups1 <- as.data.frame(cbind(soilplot=names(groups), phase=groups))
Com.Sp.groups <- merge(groups1, Com.Sp.mean.ht, by='soilplot')
##average spp by phase ----
plotspergroup <- Com.Sp.groups %>% subset(select=c(Observation_ID, phase)) %>% unique() %>% group_by(phase) %>%
summarise(nplots = length(Observation_ID))
Com.Sp.groups.sum <- aggregate(Com.Sp.groups[,c('Field', 'Shrub', 'Subcanopy','Tree', 'Total')],
by=list(Com.Sp.groups$phase, Com.Sp.groups$Species), FUN='sum')
colnames(Com.Sp.groups.sum) <- c('phase', 'Species', 'Field', 'Shrub', 'Subcanopy','Tree', 'Total')
Com.Sp.groups.count <- aggregate(unique(Com.Sp.groups[c('phase', 'Observation_ID')])$Observation_ID,
by=list(unique(Com.Sp.groups[c('phase', 'Observation_ID')])$phase), FUN='length')
colnames(Com.Sp.groups.count) <- c('phase', 'count')
Com.Sp.groups.mean <- merge(Com.Sp.groups.sum, Com.Sp.groups.count, by = 'phase')
Com.Sp.groups.mean[,c('Field', 'Shrub', 'Subcanopy','Tree', 'Total')] <- Com.Sp.groups.mean[,c('Field', 'Shrub', 'Subcanopy','Tree', 'Total')]/Com.Sp.groups.mean$count
rm(Com.Sp.groups.sum, Com.Sp.groups.count)
# aggregated total overstory and understory for species ranking
Com.Sp.groups.mean$over <- 100*(1-10^(apply(log10(1-(Com.Sp.groups.mean[,c('Subcanopy', 'Tree')]/100.001)), MARGIN = 1, FUN='sum')))
Com.Sp.groups.mean$under <- 100*(1-10^(apply(log10(1-(Com.Sp.groups.mean[,c('Field', 'Shrub')]/100.001)), MARGIN = 1, FUN='sum')))
View(Com.Sp.groups.mean)
View(Com.Sp.sum)
View(Com.Sp.groups.freq)
substitutesymbols <- as.data.frame(cbind(SYMBOL2=c('2AG','TRBO2','SMLA3','CAREX'), form2=c('Nonvascular','Forb/Herb','Forb/Herb','Grass/grass-like (Graminoids)'), type2=c('Native','Native','Native','Native'), taxon=c('Chara','Lysimachia borealis','Smilax lasioneuron','Carex [ovales]')), stringsAsFactors = FALSE)
# data ----
Plant_Heights <- read.delim("data/Plant_Heights.txt", na.strings = '', stringsAsFactors = FALSE, encoding = 'UTF-8')
# heights ----
#transfer canopy heights to appropriate stratum
#
obsspp <- obsspp %>% mutate(
Tmax = ifelse(
!is.na(Hmax) & Hmax > 15 & is.na(Tmax) & !grepl('^H',Habit), Hmax, Tmax),
Tmin = ifelse(
!is.na(Hmax) & Hmax > 15 & is.na(Tmin) & !grepl('^H',Habit), Hmin, Tmin),
SCmax = ifelse(
!is.na(Hmax) & Hmax > 5 & Hmax <= 15 & is.na(SCmax) & !grepl('^H',Habit), Hmax, SCmax),
SCmin = ifelse(
!is.na(Hmax) & Hmax > 5 & Hmax <= 15 & is.na(SCmin) & !grepl('^H',Habit), Hmin, SCmin),
Smax = ifelse(
!is.na(Hmax) & Hmax > 0.5 & Hmax <= 5 & is.na(Smax) & !grepl('^H',Habit), Hmax, Smax),
Smin = ifelse(
!is.na(Hmax) & Hmax > 0.5 & Hmax <= 5 & is.na(Smin) & !grepl('^H',Habit), Hmin, Smin),
Fmax = ifelse(
!is.na(Hmax) & Hmax > 0 & Hmax <= 0.5 & is.na(Fmax) | grepl('^H',Habit), Hmax, Fmax),
Fmin = ifelse(
!is.na(Hmax) & Hmax > 0 & Hmax <= 0.5 & is.na(Fmin) | grepl('^H',Habit), Hmin, Fmin))
Com.Sp.hts <- obsspp %>% group_by(Observation_Label, AcTaxon, Simple) %>%
summarise(
Fmin=mean(Fmin, na.rm=T),
Fmax=mean(Fmax, na.rm=T),
Smin=mean(Smin, na.rm=T),
Smax=mean(Smax, na.rm=T),
SCmin=mean(SCmin, na.rm=T),
SCmax=mean(SCmax, na.rm=T),
Tmin=mean(Tmin, na.rm=T),
Tmax=mean(Tmax, na.rm=T),
Dmin=mean(Dmin, na.rm=T),
Dmax=mean(Dmax, na.rm=T)
)
Com.Sp.mean.ht <- Com.Sp.mean %>% left_join(Com.Sp.hts, by=c('Observation_Label'='Observation_Label', 'Species'='AcTaxon', 'Simple'='Simple'))
#ensure not to exceed 100%
Com.Sp.mean.ht$Field <- ifelse(Com.Sp.mean.ht$Field > 100,100,Com.Sp.mean.ht$Field)
Com.Sp.mean.ht$Shrub <- ifelse(Com.Sp.mean.ht$Shrub > 100,100,Com.Sp.mean.ht$Shrub)
Com.Sp.mean.ht$Subcanopy <- ifelse(Com.Sp.mean.ht$Subcanopy > 100,100,Com.Sp.mean.ht$Subcanopy)
Com.Sp.mean.ht$Tree <- ifelse(Com.Sp.mean.ht$Tree > 100,100,Com.Sp.mean.ht$Tree)
#average overstory and understory
Com.Sp.mean.ht$Total <- 100*(1-10^(apply(log10(1-(Com.Sp.mean.ht[,c('Field', 'Shrub', 'Subcanopy', 'Tree')]/100.001)), MARGIN = 1, FUN='sum')))
Com.Sp.mean.ht <-subset(Com.Sp.mean.ht, !substr(Species,1,1) %in% '-'& !Species %in% '')
##cluster derived phases ----
groups1 <- as.data.frame(cbind(soilplot=names(groups), phase=groups))
Com.Sp.groups <- merge(groups1, Com.Sp.mean.ht, by='soilplot')
##average spp by phase ----
Com.Sp.groups.sum <- aggregate(Com.Sp.groups[,c('Field', 'Shrub', 'Subcanopy','Tree', 'Total')],
by=list(Com.Sp.groups$phase, Com.Sp.groups$Species), FUN='sum')
colnames(Com.Sp.groups.sum) <- c('phase', 'Species', 'Field', 'Shrub', 'Subcanopy','Tree', 'Total')
Com.Sp.groups.count <- aggregate(unique(Com.Sp.groups[c('phase', 'Observation_ID')])$Observation_ID,
by=list(unique(Com.Sp.groups[c('phase', 'Observation_ID')])$phase), FUN='length')
colnames(Com.Sp.groups.count) <- c('phase', 'count')
Com.Sp.groups.mean <- merge(Com.Sp.groups.sum, Com.Sp.groups.count, by = 'phase')
Com.Sp.groups.mean[,c('Field', 'Shrub', 'Subcanopy','Tree', 'Total')] <- Com.Sp.groups.mean[,c('Field', 'Shrub', 'Subcanopy','Tree', 'Total')]/Com.Sp.groups.mean$count
rm(Com.Sp.groups.sum, Com.Sp.groups.count)
# aggregated total overstory and understory for species ranking
Com.Sp.groups.mean$over <- 100*(1-10^(apply(log10(1-(Com.Sp.groups.mean[,c('Subcanopy', 'Tree')]/100.001)), MARGIN = 1, FUN='sum')))
Com.Sp.groups.mean$under <- 100*(1-10^(apply(log10(1-(Com.Sp.groups.mean[,c('Field', 'Shrub')]/100.001)), MARGIN = 1, FUN='sum')))
##average heights by phase ----
Com.Sp.groups.hts <- Com.Sp.groups %>% group_by(phase, Species, Simple) %>%
summarise(
Fmin=mean(Fmin, na.rm=T),
Fmax=mean(Fmax, na.rm=T),
Smin=mean(Smin, na.rm=T),
Smax=mean(Smax, na.rm=T),
SCmin=mean(SCmin, na.rm=T),
SCmax=mean(SCmax, na.rm=T),
Tmin=mean(Tmin, na.rm=T),
Tmax=mean(Tmax, na.rm=T),
Dmin=mean(Dmin, na.rm=T),
Dmax=mean(Dmax, na.rm=T)
)
Com.Sp.groups.hts <-  as.data.frame(Com.Sp.groups.hts)
for (i in 1:ncol(Com.Sp.groups.hts)){#i=3
Com.Sp.groups.hts[is.nan(Com.Sp.groups.hts[,i]),i] <- NA
}#clean up NaNs
#percentile spp by phase ----
#
countbyphase <- subset(Com.Sp.groups, select= c(soilplot, phase)) %>% unique() %>% group_by(phase) %>% summarise(total=length(soilplot))
Com.Sp.groups.pctl <- Com.Sp.groups %>% group_by(phase, Species) %>% summarise(
f25 = quantile(Field, 0.15),
f75 = quantile(Field, 0.85),
s25 = quantile(Shrub, 0.15),
s75 = quantile(Shrub, 0.85),
sc25 = quantile(Subcanopy, 0.15),
sc75 = quantile(Subcanopy, 0.85),
t25 = quantile(Tree, 0.15),
t75 = quantile(Tree, 0.85),
b05 = quantile(BA, 0.05, na.rm = TRUE),
b95 = quantile(BA, 0.95, na.rm = TRUE),
freq = sum(Field+Shrub+Subcanopy+Tree>0)
) %>% left_join(countbyphase)
Com.Sp.groups.pctl$freq <- Com.Sp.groups.pctl$freq/Com.Sp.groups.pctl$total*100
# adjust max min values to frequency
Com.Sp.groups.pctl$f75 <- pmin(1,Com.Sp.groups.pctl$freq*3/200)*Com.Sp.groups.pctl$f75
Com.Sp.groups.pctl$s75 <- pmin(1,Com.Sp.groups.pctl$freq*3/200)*Com.Sp.groups.pctl$s75
Com.Sp.groups.pctl$sc75 <- pmin(1,Com.Sp.groups.pctl$freq*3/200)*Com.Sp.groups.pctl$sc75
Com.Sp.groups.pctl$t75 <- pmin(1,Com.Sp.groups.pctl$freq*3/200)*Com.Sp.groups.pctl$t75
Com.Sp.groups.pctl$b95 <- pmin(1,Com.Sp.groups.pctl$freq*3/200)*Com.Sp.groups.pctl$b95
Com.Sp.groups.pctl$f25 <- pmax(0,Com.Sp.groups.pctl$freq*3/200-1/2)*Com.Sp.groups.pctl$f25
Com.Sp.groups.pctl$s25 <- pmax(0,Com.Sp.groups.pctl$freq*3/200-1/2)*Com.Sp.groups.pctl$s25
Com.Sp.groups.pctl$sc25 <- pmax(0,Com.Sp.groups.pctl$freq*3/200-1/2)*Com.Sp.groups.pctl$sc25
Com.Sp.groups.pctl$t25 <- pmax(0,Com.Sp.groups.pctl$freq*3/200-1/2)*Com.Sp.groups.pctl$t25
Com.Sp.groups.pctl$b05 <- pmax(0,Com.Sp.groups.pctl$freq*3/200-1/2)*Com.Sp.groups.pctl$b05
View(Com.Sp.groups.pctl)
#Com.Sp.groups.pctl[,c('f05','s05','sc05','t05','f75','s75','sc75','t75','b05','b95')] <- lapply(Com.Sp.groups.pctl[,c('f05','s05','sc05','t05','f75','s75','sc75','t75','b05','b95')], FUN=roundF)
##combine results ----
Group.Summary <- merge(Com.Sp.groups.pctl, Com.Sp.groups.hts, by=c('phase','Species'), all.x = T)
Group.Summary <- merge(listspp[,c('Taxon', 'Symbol','Form','Nativity')], Group.Summary, by.x = 'Taxon', by.y = 'Species', all.y = TRUE)
Group.Summary <- merge(Group.Summary, substitutesymbols, by.x = 'Taxon', by.y='taxon', all.x = TRUE)
Group.Summary <- merge(List_Habits[,c('Form', 'ESIS.Group')], Group.Summary, by = 'Form', all.y = TRUE)
Group.Summary <- merge(Group.Summary, Com.Sp.groups.mean[,c('Species','phase','over','under')],
by.x = c('Taxon','phase'), by.y=c('Species','phase'), all.x = TRUE)
##replacement values ----
Group.Summary[is.na(Group.Summary$Symbol) & !is.na(Group.Summary$SYMBOL2),]$Symbol <-
Group.Summary[is.na(Group.Summary$Symbol) & !is.na(Group.Summary$SYMBOL2),]$SYMBOL2
Group.Summary[is.na(Group.Summary$ESIS.Group) & !is.na(Group.Summary$form2),]$ESIS.Group <-
Group.Summary[is.na(Group.Summary$ESIS.Group) & !is.na(Group.Summary$form2),]$form2
Group.Summary[is.na(Group.Summary$Nativity) & !is.na(Group.Summary$type2),]$Nativity <-
Group.Summary[is.na(Group.Summary$Nativity) & !is.na(Group.Summary$type2),]$type2
# group summary export and fix missing heights ----
Group.Summary <- Group.Summary[order(Group.Summary$phase, Group.Summary$Taxon),c( 'phase','Taxon', 'Symbol', 'ESIS.Group','Nativity', 'f25', 'f75', 's25', 's75', 'sc25', 'sc75', 't25', 't75', 'Fmin', 'Fmax', 'Smin', 'Smax', 'SCmin', 'SCmax', 'Tmin', 'Tmax','Dmin','Dmax','b05','b95', 'over', 'under')]
colnames(Group.Summary) <- c( 'phase','Taxon', 'Plant.Symbol', 'Plant.Type','Nativity', 'f25', 'f75', 's25', 's75', 'sc25', 'sc75', 't25', 't75', 'Fmin', 'Fmax', 'Smin', 'Smax', 'SCmin', 'SCmax', 'Tmin', 'Tmax','Dmin','Dmax','b05','b95', 'over', 'under')
Group.Summary$maxHt <- pmax(Group.Summary$Fmax,Group.Summary$Smax,Group.Summary$SCmax,Group.Summary$Tmax, na.rm = TRUE)
Group.Summary <- merge(Group.Summary, Plant_Heights[,c('Scientific.Name', 'Ht_m')], by.x = 'Taxon', by.y='Scientific.Name', all.x=TRUE)
Group.Summary[is.na(Group.Summary$maxHt),]$maxHt <- Group.Summary[is.na(Group.Summary$maxHt),]$Ht_m
Group.Summary[Group.Summary$Plant.Type %in% 'Vine/Liana',]$maxHt <- NA
Forest.Overstory <- Group.Summary[Group.Summary$t75 >0,c( 'phase','Taxon',  'Plant.Symbol', 'Plant.Type','Nativity', 't25', 't75','Tmin', 'Tmax','Dmin','Dmax','b05','b95', 'maxHt', 'over')]
colnames(Forest.Overstory) <- c('phase','Taxon',  'Plant.Symbol', 'Plant.Type','Nativity', 'Cover.Low', 'Cover.High','Canopy.Bottom', 'Canopy.Top','Diam.Low','Diam.High','BA.Low','BA.High', 'maxHt', 'over')
Forest.Overstory <- Forest.Overstory %>% mutate(
Canopy.Bottom = ifelse(
is.na(Canopy.Bottom) & Plant.Type %in% c('Shrub/Subshrub','Vine/Liana'), 5, Canopy.Bottom),
Canopy.Bottom = ifelse(
is.na(Canopy.Bottom) & Plant.Type %in% c('Tree'), 10, Canopy.Bottom),
Canopy.Top = ifelse(
is.na(Canopy.Top) & Plant.Type %in% c('Shrub/Subshrub'), 17, Canopy.Top),
Canopy.Top = ifelse(
is.na(Canopy.Top) & Plant.Type %in% c('Vine/Liana'), 20, Canopy.Top),
Canopy.Top = ifelse(
is.na(Canopy.Top) & Plant.Type %in% c('Tree'), 25, Canopy.Top),
Canopy.Bottom = ifelse(
is.na(Canopy.Bottom), 15, Canopy.Bottom),
Canopy.Top = ifelse(
!is.na(maxHt) & maxHt > 15, pmin(Canopy.Top, maxHt),Canopy.Top),
Canopy.Bottom = ifelse(
!is.na(maxHt) & maxHt > 15, pmin(Canopy.Bottom, maxHt), Canopy.Bottom),
Cover.Low = ifelse(
Cover.Low == Cover.High, pmax(0, Cover.Low*.75-5) ,Cover.Low))
Forest.Overstory.sub<- Group.Summary[Group.Summary$sc75 >0,c( 'phase','Taxon', 'Plant.Symbol', 'Plant.Type','Nativity','sc25', 'sc75','SCmin', 'SCmax', 'Dmin','Dmax','b05','b95', 'maxHt', 'over')]
Forest.Overstory.sub[,c('Dmin','Dmax','b05','b95')]<- NA
colnames(Forest.Overstory.sub) <- c('phase','Taxon', 'Plant.Symbol', 'Plant.Type','Nativity', 'Cover.Low', 'Cover.High','Canopy.Bottom', 'Canopy.Top','Diam.Low','Diam.High','BA.Low','BA.High','maxHt', 'over')
Forest.Overstory.sub <- Forest.Overstory.sub %>% mutate(
Canopy.Bottom = ifelse(
is.na(Canopy.Bottom) & Plant.Type %in% c('Shrub/Subshrub','Vine/Liana'), 2, Canopy.Bottom),
Canopy.Bottom = ifelse(
is.na(Canopy.Bottom) & Plant.Type %in% c('Tree'), 5, Canopy.Bottom),
Canopy.Top = ifelse(
is.na(Canopy.Top) & Plant.Type %in% c('Shrub/Subshrub'), 6, Canopy.Top),
Canopy.Top = ifelse(
is.na(Canopy.Top) & Plant.Type %in% c('Vine/Liana','Tree'), 15, Canopy.Top),
Canopy.Bottom = ifelse(
is.na(Canopy.Bottom), 5, Canopy.Bottom),
Canopy.Top = ifelse(
!is.na(maxHt) & maxHt > 5, pmin(Canopy.Top, maxHt),Canopy.Top),
Canopy.Bottom = ifelse(
!is.na(maxHt) & maxHt > 5, pmin(Canopy.Bottom, maxHt), Canopy.Bottom),
Cover.Low = ifelse(
Cover.Low == Cover.High, pmax(0, Cover.Low*.75-5) ,Cover.Low))
Forest.Overstory <- rbind(Forest.Overstory, Forest.Overstory.sub)
Forest.Understory <- Group.Summary[Group.Summary$s75 >0,c( 'phase','Taxon', 'Plant.Symbol', 'Plant.Type','Nativity', 's25', 's75','Smin', 'Smax', 'maxHt', 'under')]
colnames(Forest.Understory) <- c('phase','Taxon','Plant.Symbol', 'Plant.Type','Nativity', 'Cover.Low', 'Cover.High','Canopy.Bottom', 'Canopy.Top', 'maxHt', 'under')
Forest.Understory <- Forest.Understory %>% mutate(
Canopy.Bottom = ifelse(
is.na(Canopy.Bottom) & Plant.Type %in% c('Shrub/Subshrub'), 0.5, Canopy.Bottom),
Canopy.Bottom = ifelse(
is.na(Canopy.Bottom) & Plant.Type %in% c('Tree','Vine/Liana'), 1, Canopy.Bottom),
Canopy.Top = ifelse(
is.na(Canopy.Top) & Plant.Type %in% c('Shrub/Subshrub'), 2, Canopy.Top),
Canopy.Top = ifelse(
is.na(Canopy.Top) & Plant.Type %in% c('Tree','Vine/Liana'), 5, Canopy.Top),
Canopy.Bottom = ifelse(
is.na(Canopy.Bottom), 0.5, Canopy.Bottom),
Canopy.Top = ifelse(
!is.na(maxHt) & maxHt > 0.5, pmin(Canopy.Top, maxHt),Canopy.Top),
Canopy.Bottom = ifelse(
!is.na(maxHt) & maxHt > 0.5, pmin(Canopy.Bottom, maxHt), Canopy.Bottom),
Cover.Low = ifelse(
Cover.Low == Cover.High, pmax(0, Cover.Low*.75-5) ,Cover.Low))
Forest.Understory.sub <- Group.Summary[Group.Summary$f75 >0,c( 'phase','Taxon','Plant.Symbol', 'Plant.Type','Nativity', 'f25', 'f75','Fmin', 'Fmax', 'maxHt', 'under')]
colnames(Forest.Understory.sub) <- c('phase','Taxon','Plant.Symbol', 'Plant.Type','Nativity', 'Cover.Low', 'Cover.High','Canopy.Bottom', 'Canopy.Top', 'maxHt', 'under')
Forest.Understory.sub <- Forest.Understory.sub %>% mutate(
Canopy.Top = ifelse(
Plant.Type %in% c('Nonvascular'), 0 ,Canopy.Top),
Canopy.Bottom = ifelse(
Plant.Type %in% c('Nonvascular'), 0 ,Canopy.Bottom),
Canopy.Top = ifelse(
is.na(Canopy.Top) & !is.na(maxHt) & Plant.Type %in% c('Grass/grass-like (Graminoids)','Fern/fern ally','Forb/Herb'), pmin(maxHt, 1.5), Canopy.Top),
Canopy.Top = ifelse(
is.na(Canopy.Top) & Plant.Type %in% c('Grass/grass-like (Graminoids)','Fern/fern ally','Forb/Herb'), 0.6, Canopy.Top),
Canopy.Top = ifelse(
is.na(Canopy.Top) & Plant.Type %in% c('Shrub/Subshrub'), 0.3, Canopy.Top),
Canopy.Top = ifelse(
is.na(Canopy.Top), 0.5 ,Canopy.Top),
Canopy.Bottom = ifelse(
is.na(Canopy.Bottom), Canopy.Top/2 ,Canopy.Bottom),
Canopy.Bottom = ifelse(
Canopy.Bottom == Canopy.Top, Canopy.Top*.75 ,Canopy.Bottom),
Cover.Low = ifelse(
Cover.Low == Cover.High, pmax(0, Cover.Low*.75-5) ,Cover.Low))
Forest.Understory <- rbind(Forest.Understory, Forest.Understory.sub)
Forest.Overstory[,c('Cover.Low', 'Cover.High', 'Diam.Low', 'Diam.High', 'BA.Low', 'BA.High')] <- lapply(Forest.Overstory[,c('Cover.Low', 'Cover.High', 'Diam.Low', 'Diam.High', 'BA.Low', 'BA.High')], FUN=roundF)
Forest.Overstory[,c('Canopy.Bottom', 'Canopy.Top')] <- lapply(Forest.Overstory[,c('Canopy.Bottom', 'Canopy.Top')], FUN=roundH)
Forest.Understory[,c('Cover.Low', 'Cover.High')] <- lapply(Forest.Understory[,c('Cover.Low', 'Cover.High')], FUN=roundF)
Forest.Understory[,c('Canopy.Bottom', 'Canopy.Top')] <- lapply(Forest.Understory[,c('Canopy.Bottom', 'Canopy.Top')], FUN=roundH)
Sort_Habits <- read.delim("data/Sort_Habits.txt", na.strings = '', stringsAsFactors = FALSE)
Forest.Overstory1 <- merge(Forest.Overstory, Sort_Habits, by='Plant.Type', all.x = TRUE)
Forest.Understory1 <- merge(Forest.Understory, Sort_Habits, by='Plant.Type', all.x = TRUE)
Forest.Overstory1 <- Forest.Overstory1[order(
Forest.Overstory1$phase,
Forest.Overstory1$order,
-Forest.Overstory1$over,
Forest.Overstory1$Taxon,
-Forest.Overstory1$Canopy.Top
),c('phase',	'Taxon', 'order', 'over', 'Plant.Symbol',	'Plant.Type',	'Nativity',	'Cover.Low',	'Cover.High',	'Canopy.Bottom',	'Canopy.Top',	'Diam.Low',	'Diam.High',	'BA.Low',	'BA.High')]
Forest.Understory1 <- Forest.Understory1[order(
Forest.Understory1$phase,
Forest.Understory1$order,
-Forest.Understory1$under,
Forest.Understory1$Taxon,
-Forest.Understory1$Canopy.Top
),c('phase',	'Taxon', 'order', 'under', 'Plant.Symbol',	'Plant.Type',	'Nativity',	'Cover.Low',	'Cover.High',	'Canopy.Bottom',	'Canopy.Top')]
Forest.Overstory1 <- subset(Forest.Overstory1, Cover.High > 0)
# Forest.Overstory1$Cover.High <- pmax(0.1, Forest.Overstory1$Cover.High)
Forest.Understory1 <- subset(Forest.Understory1, Cover.High > 0)
# Forest.Understory1$Cover.High <- pmax(0.1, Forest.Understory1$Cover.High)
View(Forest.Overstory)
View(Group.Summary)
substitutesymbols <- as.data.frame(cbind(SYMBOL2=c('2AG','TRBO2','SMLA3','CAREX'), form2=c('Nonvascular','Forb/Herb','Forb/Herb','Grass/grass-like (Graminoids)'), type2=c('Native','Native','Native','Native'), taxon=c('Chara','Lysimachia borealis','Smilax lasioneuron','Carex [ovales]')), stringsAsFactors = FALSE)
# data ----
Plant_Heights <- read.delim("data/Plant_Heights.txt", na.strings = '', stringsAsFactors = FALSE, encoding = 'UTF-8')
# heights ----
#transfer canopy heights to appropriate stratum
#
obsspp <- obsspp %>% mutate(
Tmax = ifelse(
!is.na(Hmax) & Hmax > 15 & is.na(Tmax) & !grepl('^H',Habit), Hmax, Tmax),
Tmin = ifelse(
!is.na(Hmax) & Hmax > 15 & is.na(Tmin) & !grepl('^H',Habit), Hmin, Tmin),
SCmax = ifelse(
!is.na(Hmax) & Hmax > 5 & Hmax <= 15 & is.na(SCmax) & !grepl('^H',Habit), Hmax, SCmax),
SCmin = ifelse(
!is.na(Hmax) & Hmax > 5 & Hmax <= 15 & is.na(SCmin) & !grepl('^H',Habit), Hmin, SCmin),
Smax = ifelse(
!is.na(Hmax) & Hmax > 0.5 & Hmax <= 5 & is.na(Smax) & !grepl('^H',Habit), Hmax, Smax),
Smin = ifelse(
!is.na(Hmax) & Hmax > 0.5 & Hmax <= 5 & is.na(Smin) & !grepl('^H',Habit), Hmin, Smin),
Fmax = ifelse(
!is.na(Hmax) & Hmax > 0 & Hmax <= 0.5 & is.na(Fmax) | grepl('^H',Habit), Hmax, Fmax),
Fmin = ifelse(
!is.na(Hmax) & Hmax > 0 & Hmax <= 0.5 & is.na(Fmin) | grepl('^H',Habit), Hmin, Fmin))
Com.Sp.hts <- obsspp %>% group_by(Observation_Label, AcTaxon, Simple) %>%
summarise(
Fmin=mean(Fmin, na.rm=T),
Fmax=mean(Fmax, na.rm=T),
Smin=mean(Smin, na.rm=T),
Smax=mean(Smax, na.rm=T),
SCmin=mean(SCmin, na.rm=T),
SCmax=mean(SCmax, na.rm=T),
Tmin=mean(Tmin, na.rm=T),
Tmax=mean(Tmax, na.rm=T),
Dmin=mean(Dmin, na.rm=T),
Dmax=mean(Dmax, na.rm=T)
)
Com.Sp.mean.ht <- Com.Sp.mean %>% left_join(Com.Sp.hts, by=c('Observation_Label'='Observation_Label', 'Species'='AcTaxon', 'Simple'='Simple'))
#ensure not to exceed 100%
Com.Sp.mean.ht$Field <- ifelse(Com.Sp.mean.ht$Field > 100,100,Com.Sp.mean.ht$Field)
Com.Sp.mean.ht$Shrub <- ifelse(Com.Sp.mean.ht$Shrub > 100,100,Com.Sp.mean.ht$Shrub)
Com.Sp.mean.ht$Subcanopy <- ifelse(Com.Sp.mean.ht$Subcanopy > 100,100,Com.Sp.mean.ht$Subcanopy)
Com.Sp.mean.ht$Tree <- ifelse(Com.Sp.mean.ht$Tree > 100,100,Com.Sp.mean.ht$Tree)
#average overstory and understory
Com.Sp.mean.ht$Total <- 100*(1-10^(apply(log10(1-(Com.Sp.mean.ht[,c('Field', 'Shrub', 'Subcanopy', 'Tree')]/100.001)), MARGIN = 1, FUN='sum')))
Com.Sp.mean.ht <-subset(Com.Sp.mean.ht, !substr(Species,1,1) %in% '-'& !Species %in% '')
##cluster derived phases ----
groups1 <- as.data.frame(cbind(soilplot=names(groups), phase=groups))
Com.Sp.groups <- merge(groups1, Com.Sp.mean.ht, by='soilplot')
##average spp by phase ----
Com.Sp.groups.sum <- aggregate(Com.Sp.groups[,c('Field', 'Shrub', 'Subcanopy','Tree', 'Total')],
by=list(Com.Sp.groups$phase, Com.Sp.groups$Species), FUN='sum')
colnames(Com.Sp.groups.sum) <- c('phase', 'Species', 'Field', 'Shrub', 'Subcanopy','Tree', 'Total')
Com.Sp.groups.count <- aggregate(unique(Com.Sp.groups[c('phase', 'Observation_ID')])$Observation_ID,
by=list(unique(Com.Sp.groups[c('phase', 'Observation_ID')])$phase), FUN='length')
colnames(Com.Sp.groups.count) <- c('phase', 'count')
Com.Sp.groups.mean <- merge(Com.Sp.groups.sum, Com.Sp.groups.count, by = 'phase')
Com.Sp.groups.mean[,c('Field', 'Shrub', 'Subcanopy','Tree', 'Total')] <- Com.Sp.groups.mean[,c('Field', 'Shrub', 'Subcanopy','Tree', 'Total')]/Com.Sp.groups.mean$count
rm(Com.Sp.groups.sum, Com.Sp.groups.count)
# aggregated total overstory and understory for species ranking
Com.Sp.groups.mean$over <- 100*(1-10^(apply(log10(1-(Com.Sp.groups.mean[,c('Subcanopy', 'Tree')]/100.001)), MARGIN = 1, FUN='sum')))
Com.Sp.groups.mean$under <- 100*(1-10^(apply(log10(1-(Com.Sp.groups.mean[,c('Field', 'Shrub')]/100.001)), MARGIN = 1, FUN='sum')))
##average heights by phase ----
Com.Sp.groups.hts <- Com.Sp.groups %>% group_by(phase, Species, Simple) %>%
summarise(
Fmin=mean(Fmin, na.rm=T),
Fmax=mean(Fmax, na.rm=T),
Smin=mean(Smin, na.rm=T),
Smax=mean(Smax, na.rm=T),
SCmin=mean(SCmin, na.rm=T),
SCmax=mean(SCmax, na.rm=T),
Tmin=mean(Tmin, na.rm=T),
Tmax=mean(Tmax, na.rm=T),
Dmin=mean(Dmin, na.rm=T),
Dmax=mean(Dmax, na.rm=T)
)
Com.Sp.groups.hts <-  as.data.frame(Com.Sp.groups.hts)
for (i in 1:ncol(Com.Sp.groups.hts)){#i=3
Com.Sp.groups.hts[is.nan(Com.Sp.groups.hts[,i]),i] <- NA
}#clean up NaNs
#percentile spp by phase ----
#
countbyphase <- subset(Com.Sp.groups, select= c(soilplot, phase)) %>% unique() %>% group_by(phase) %>% summarise(total=length(soilplot))
Com.Sp.groups.pctl <- Com.Sp.groups %>% group_by(phase, Species) %>% summarise(
f25 = quantile(Field, 0.15),
f75 = quantile(Field, 0.85),
s25 = quantile(Shrub, 0.15),
s75 = quantile(Shrub, 0.85),
sc25 = quantile(Subcanopy, 0.15),
sc75 = quantile(Subcanopy, 0.85),
t25 = quantile(Tree, 0.15),
t75 = quantile(Tree, 0.85),
b05 = quantile(BA, 0.05, na.rm = TRUE),
b95 = quantile(BA, 0.95, na.rm = TRUE),
freq = sum(Field+Shrub+Subcanopy+Tree>0)
) %>% left_join(countbyphase)
Com.Sp.groups.pctl$freq <- Com.Sp.groups.pctl$freq/Com.Sp.groups.pctl$total*100
# adjust max min values to frequency
Com.Sp.groups.pctl$f75 <- pmin(1,Com.Sp.groups.pctl$freq*3/200)*Com.Sp.groups.pctl$f75
Com.Sp.groups.pctl$s75 <- pmin(1,Com.Sp.groups.pctl$freq*3/200)*Com.Sp.groups.pctl$s75
Com.Sp.groups.pctl$sc75 <- pmin(1,Com.Sp.groups.pctl$freq*3/200)*Com.Sp.groups.pctl$sc75
Com.Sp.groups.pctl$t75 <- pmin(1,Com.Sp.groups.pctl$freq*3/200)*Com.Sp.groups.pctl$t75
Com.Sp.groups.pctl$b95 <- pmin(1,Com.Sp.groups.pctl$freq*3/200)*Com.Sp.groups.pctl$b95
Com.Sp.groups.pctl$f25 <- pmax(0,Com.Sp.groups.pctl$freq*3/200-1/2)*Com.Sp.groups.pctl$f25
Com.Sp.groups.pctl$s25 <- pmax(0,Com.Sp.groups.pctl$freq*3/200-1/2)*Com.Sp.groups.pctl$s25
Com.Sp.groups.pctl$sc25 <- pmax(0,Com.Sp.groups.pctl$freq*3/200-1/2)*Com.Sp.groups.pctl$sc25
Com.Sp.groups.pctl$t25 <- pmax(0,Com.Sp.groups.pctl$freq*3/200-1/2)*Com.Sp.groups.pctl$t25
Com.Sp.groups.pctl$b05 <- pmax(0,Com.Sp.groups.pctl$freq*3/200-1/2)*Com.Sp.groups.pctl$b05
#Com.Sp.groups.pctl[,c('f05','s05','sc05','t05','f75','s75','sc75','t75','b05','b95')] <- lapply(Com.Sp.groups.pctl[,c('f05','s05','sc05','t05','f75','s75','sc75','t75','b05','b95')], FUN=roundF)
##combine results ----
Group.Summary <- merge(Com.Sp.groups.pctl, Com.Sp.groups.hts, by=c('phase','Species'), all.x = T)
Group.Summary <- merge(listspp[,c('Taxon', 'Symbol','Form','Nativity')], Group.Summary, by.x = 'Taxon', by.y = 'Species', all.y = TRUE)
Group.Summary <- merge(Group.Summary, substitutesymbols, by.x = 'Taxon', by.y='taxon', all.x = TRUE)
Group.Summary <- merge(List_Habits[,c('Form', 'ESIS.Group')], Group.Summary, by = 'Form', all.y = TRUE)
Group.Summary <- merge(Group.Summary, Com.Sp.groups.mean[,c('Species','phase','over','under')],
by.x = c('Taxon','phase'), by.y=c('Species','phase'), all.x = TRUE)
##replacement values ----
Group.Summary[is.na(Group.Summary$Symbol) & !is.na(Group.Summary$SYMBOL2),]$Symbol <-
Group.Summary[is.na(Group.Summary$Symbol) & !is.na(Group.Summary$SYMBOL2),]$SYMBOL2
Group.Summary[is.na(Group.Summary$ESIS.Group) & !is.na(Group.Summary$form2),]$ESIS.Group <-
Group.Summary[is.na(Group.Summary$ESIS.Group) & !is.na(Group.Summary$form2),]$form2
Group.Summary[is.na(Group.Summary$Nativity) & !is.na(Group.Summary$type2),]$Nativity <-
Group.Summary[is.na(Group.Summary$Nativity) & !is.na(Group.Summary$type2),]$type2
View(Group.Summary)
# group summary export and fix missing heights ----
Group.Summary <- Group.Summary[order(Group.Summary$phase, Group.Summary$Taxon),c( 'phase','Taxon', 'Symbol', 'ESIS.Group','Nativity', 'f25', 'f75', 's25', 's75', 'sc25', 'sc75', 't25', 't75', 'Fmin', 'Fmax', 'Smin', 'Smax', 'SCmin', 'SCmax', 'Tmin', 'Tmax','Dmin','Dmax','b05','b95', 'over', 'under','freq')]
colnames(Group.Summary) <- c( 'phase','Taxon', 'Plant.Symbol', 'Plant.Type','Nativity', 'f25', 'f75', 's25', 's75', 'sc25', 'sc75', 't25', 't75', 'Fmin', 'Fmax', 'Smin', 'Smax', 'SCmin', 'SCmax', 'Tmin', 'Tmax','Dmin','Dmax','b05','b95', 'over', 'under','freq')
Group.Summary$maxHt <- pmax(Group.Summary$Fmax,Group.Summary$Smax,Group.Summary$SCmax,Group.Summary$Tmax, na.rm = TRUE)
Group.Summary <- merge(Group.Summary, Plant_Heights[,c('Scientific.Name', 'Ht_m')], by.x = 'Taxon', by.y='Scientific.Name', all.x=TRUE)
Group.Summary[is.na(Group.Summary$maxHt),]$maxHt <- Group.Summary[is.na(Group.Summary$maxHt),]$Ht_m
Group.Summary[Group.Summary$Plant.Type %in% 'Vine/Liana',]$maxHt <- NA
Forest.Overstory <- Group.Summary[Group.Summary$t75 >0,c( 'phase','Taxon',  'Plant.Symbol', 'Plant.Type','Nativity', 't25', 't75','Tmin', 'Tmax','Dmin','Dmax','b05','b95', 'maxHt', 'over')]
colnames(Forest.Overstory) <- c('phase','Taxon',  'Plant.Symbol', 'Plant.Type','Nativity', 'Cover.Low', 'Cover.High','Canopy.Bottom', 'Canopy.Top','Diam.Low','Diam.High','BA.Low','BA.High', 'maxHt', 'over')
Forest.Overstory <- Forest.Overstory %>% mutate(
Canopy.Bottom = ifelse(
is.na(Canopy.Bottom) & Plant.Type %in% c('Shrub/Subshrub','Vine/Liana'), 5, Canopy.Bottom),
Canopy.Bottom = ifelse(
is.na(Canopy.Bottom) & Plant.Type %in% c('Tree'), 10, Canopy.Bottom),
Canopy.Top = ifelse(
is.na(Canopy.Top) & Plant.Type %in% c('Shrub/Subshrub'), 17, Canopy.Top),
Canopy.Top = ifelse(
is.na(Canopy.Top) & Plant.Type %in% c('Vine/Liana'), 20, Canopy.Top),
Canopy.Top = ifelse(
is.na(Canopy.Top) & Plant.Type %in% c('Tree'), 25, Canopy.Top),
Canopy.Bottom = ifelse(
is.na(Canopy.Bottom), 15, Canopy.Bottom),
Canopy.Top = ifelse(
!is.na(maxHt) & maxHt > 15, pmin(Canopy.Top, maxHt),Canopy.Top),
Canopy.Bottom = ifelse(
!is.na(maxHt) & maxHt > 15, pmin(Canopy.Bottom, maxHt), Canopy.Bottom),
Cover.Low = ifelse(
Cover.Low == Cover.High, pmax(0, Cover.Low*.75-5) ,Cover.Low))
Forest.Overstory.sub<- Group.Summary[Group.Summary$sc75 >0,c( 'phase','Taxon', 'Plant.Symbol', 'Plant.Type','Nativity','sc25', 'sc75','SCmin', 'SCmax', 'Dmin','Dmax','b05','b95', 'maxHt', 'over')]
Forest.Overstory.sub[,c('Dmin','Dmax','b05','b95')]<- NA
colnames(Forest.Overstory.sub) <- c('phase','Taxon', 'Plant.Symbol', 'Plant.Type','Nativity', 'Cover.Low', 'Cover.High','Canopy.Bottom', 'Canopy.Top','Diam.Low','Diam.High','BA.Low','BA.High','maxHt', 'over')
Forest.Overstory.sub <- Forest.Overstory.sub %>% mutate(
Canopy.Bottom = ifelse(
is.na(Canopy.Bottom) & Plant.Type %in% c('Shrub/Subshrub','Vine/Liana'), 2, Canopy.Bottom),
Canopy.Bottom = ifelse(
is.na(Canopy.Bottom) & Plant.Type %in% c('Tree'), 5, Canopy.Bottom),
Canopy.Top = ifelse(
is.na(Canopy.Top) & Plant.Type %in% c('Shrub/Subshrub'), 6, Canopy.Top),
Canopy.Top = ifelse(
is.na(Canopy.Top) & Plant.Type %in% c('Vine/Liana','Tree'), 15, Canopy.Top),
Canopy.Bottom = ifelse(
is.na(Canopy.Bottom), 5, Canopy.Bottom),
Canopy.Top = ifelse(
!is.na(maxHt) & maxHt > 5, pmin(Canopy.Top, maxHt),Canopy.Top),
Canopy.Bottom = ifelse(
!is.na(maxHt) & maxHt > 5, pmin(Canopy.Bottom, maxHt), Canopy.Bottom),
Cover.Low = ifelse(
Cover.Low == Cover.High, pmax(0, Cover.Low*.75-5) ,Cover.Low))
Forest.Overstory <- rbind(Forest.Overstory, Forest.Overstory.sub)
Forest.Understory <- Group.Summary[Group.Summary$s75 >0,c( 'phase','Taxon', 'Plant.Symbol', 'Plant.Type','Nativity', 's25', 's75','Smin', 'Smax', 'maxHt', 'under')]
colnames(Forest.Understory) <- c('phase','Taxon','Plant.Symbol', 'Plant.Type','Nativity', 'Cover.Low', 'Cover.High','Canopy.Bottom', 'Canopy.Top', 'maxHt', 'under')
Forest.Understory <- Forest.Understory %>% mutate(
Canopy.Bottom = ifelse(
is.na(Canopy.Bottom) & Plant.Type %in% c('Shrub/Subshrub'), 0.5, Canopy.Bottom),
Canopy.Bottom = ifelse(
is.na(Canopy.Bottom) & Plant.Type %in% c('Tree','Vine/Liana'), 1, Canopy.Bottom),
Canopy.Top = ifelse(
is.na(Canopy.Top) & Plant.Type %in% c('Shrub/Subshrub'), 2, Canopy.Top),
Canopy.Top = ifelse(
is.na(Canopy.Top) & Plant.Type %in% c('Tree','Vine/Liana'), 5, Canopy.Top),
Canopy.Bottom = ifelse(
is.na(Canopy.Bottom), 0.5, Canopy.Bottom),
Canopy.Top = ifelse(
!is.na(maxHt) & maxHt > 0.5, pmin(Canopy.Top, maxHt),Canopy.Top),
Canopy.Bottom = ifelse(
!is.na(maxHt) & maxHt > 0.5, pmin(Canopy.Bottom, maxHt), Canopy.Bottom),
Cover.Low = ifelse(
Cover.Low == Cover.High, pmax(0, Cover.Low*.75-5) ,Cover.Low))
Forest.Understory.sub <- Group.Summary[Group.Summary$f75 >0,c( 'phase','Taxon','Plant.Symbol', 'Plant.Type','Nativity', 'f25', 'f75','Fmin', 'Fmax', 'maxHt', 'under')]
colnames(Forest.Understory.sub) <- c('phase','Taxon','Plant.Symbol', 'Plant.Type','Nativity', 'Cover.Low', 'Cover.High','Canopy.Bottom', 'Canopy.Top', 'maxHt', 'under')
Forest.Understory.sub <- Forest.Understory.sub %>% mutate(
Canopy.Top = ifelse(
Plant.Type %in% c('Nonvascular'), 0 ,Canopy.Top),
Canopy.Bottom = ifelse(
Plant.Type %in% c('Nonvascular'), 0 ,Canopy.Bottom),
Canopy.Top = ifelse(
is.na(Canopy.Top) & !is.na(maxHt) & Plant.Type %in% c('Grass/grass-like (Graminoids)','Fern/fern ally','Forb/Herb'), pmin(maxHt, 1.5), Canopy.Top),
Canopy.Top = ifelse(
is.na(Canopy.Top) & Plant.Type %in% c('Grass/grass-like (Graminoids)','Fern/fern ally','Forb/Herb'), 0.6, Canopy.Top),
Canopy.Top = ifelse(
is.na(Canopy.Top) & Plant.Type %in% c('Shrub/Subshrub'), 0.3, Canopy.Top),
Canopy.Top = ifelse(
is.na(Canopy.Top), 0.5 ,Canopy.Top),
Canopy.Bottom = ifelse(
is.na(Canopy.Bottom), Canopy.Top/2 ,Canopy.Bottom),
Canopy.Bottom = ifelse(
Canopy.Bottom == Canopy.Top, Canopy.Top*.75 ,Canopy.Bottom),
Cover.Low = ifelse(
Cover.Low == Cover.High, pmax(0, Cover.Low*.75-5) ,Cover.Low))
Forest.Understory <- rbind(Forest.Understory, Forest.Understory.sub)
Forest.Overstory[,c('Cover.Low', 'Cover.High', 'Diam.Low', 'Diam.High', 'BA.Low', 'BA.High')] <- lapply(Forest.Overstory[,c('Cover.Low', 'Cover.High', 'Diam.Low', 'Diam.High', 'BA.Low', 'BA.High')], FUN=roundF)
Forest.Overstory[,c('Canopy.Bottom', 'Canopy.Top')] <- lapply(Forest.Overstory[,c('Canopy.Bottom', 'Canopy.Top')], FUN=roundH)
Forest.Understory[,c('Cover.Low', 'Cover.High')] <- lapply(Forest.Understory[,c('Cover.Low', 'Cover.High')], FUN=roundF)
Forest.Understory[,c('Canopy.Bottom', 'Canopy.Top')] <- lapply(Forest.Understory[,c('Canopy.Bottom', 'Canopy.Top')], FUN=roundH)
Sort_Habits <- read.delim("data/Sort_Habits.txt", na.strings = '', stringsAsFactors = FALSE)
Forest.Overstory1 <- merge(Forest.Overstory, Sort_Habits, by='Plant.Type', all.x = TRUE)
Forest.Understory1 <- merge(Forest.Understory, Sort_Habits, by='Plant.Type', all.x = TRUE)
Forest.Overstory1 <- Forest.Overstory1[order(
Forest.Overstory1$phase,
Forest.Overstory1$order,
-Forest.Overstory1$over,
Forest.Overstory1$Taxon,
-Forest.Overstory1$Canopy.Top
),c('phase',	'Taxon', 'order', 'over', 'Plant.Symbol',	'Plant.Type',	'Nativity',	'Cover.Low',	'Cover.High',	'Canopy.Bottom',	'Canopy.Top',	'Diam.Low',	'Diam.High',	'BA.Low',	'BA.High')]
Forest.Understory1 <- Forest.Understory1[order(
Forest.Understory1$phase,
Forest.Understory1$order,
-Forest.Understory1$under,
Forest.Understory1$Taxon,
-Forest.Understory1$Canopy.Top
),c('phase',	'Taxon', 'order', 'under', 'Plant.Symbol',	'Plant.Type',	'Nativity',	'Cover.Low',	'Cover.High',	'Canopy.Bottom',	'Canopy.Top')]
Forest.Overstory1 <- subset(Forest.Overstory1, Cover.High > 0)
# Forest.Overstory1$Cover.High <- pmax(0.1, Forest.Overstory1$Cover.High)
Forest.Understory1 <- subset(Forest.Understory1, Cover.High > 0)
# Forest.Understory1$Cover.High <- pmax(0.1, Forest.Understory1$Cover.High)
View(Forest.Understory1)
