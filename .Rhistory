makeplot(a,d,tward,k)
}
if (T){
a <- 'regroup'
makeplotgroup(a,d,tward,groups)
}
source('groupplotsummary.R')
Com.Structure[order(as.numeric(as.character(Com.Structure$cluster))),c("cluster", "association", "WetStructure")]
View(listspp)
View(clind.table)
View(ulc.table)
library(dendextend)
library(dplyr)
library(dynamicTreeCut)
library(rpart)
library(rpart.plot)
library(goeveg)
library(proxy)
library(foreign)
library(optpart)
library(dendsort)
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
# Load Veg tables ----
source('processplot.R')
#load clustering functions ----
source('clusterfunctions.R')
#group parameters ----
beta= -0.2
k = 6
d <- vegdist(plotdata, method='bray', binary=FALSE, na.rm=T)
tbeta <- d %>% flexbeta(beta= beta)
tward <- agnes(d, method = 'ward') %>% as.hclust()
t=tbeta
t=tward
# t=dendsort(t)
# dk <- dynamicK(t, d)
# dkward <- dynamicK(tward, d)
# groups <- cutree(t, k = k)
# maxCoreScatter <- dk[dk$nclust %in% k,]$maxcor
# minGap <- (1 - maxCoreScatter) * 3/4
# dyngroups <-
#   cutreeDynamic(t, minClusterSize=1, method = 'hybrid', distM=as.matrix(d),deepSplit=1, maxCoreScatter=maxCoreScatter, minGap=minGap, maxAbsCoreScatter=NULL, minAbsGap=NULL)
# groups=dyngroups
groups <- cutree(t, k = k)
groups <- grouporder(t, groups)
# grouporder <- function(t,groups){
# soilplot <- names(d)
# clust <- unname(groups)
# groupdf <- as.data.frame(cbind(soilplot, clust))
# groupdf$clust <- (as.numeric(as.character(groupdf$clust)))
# torder <- as.data.frame(cbind(trow=t$order))
# torder$torder <- row(torder)[,1]
# newlabels <- as.data.frame(cbind(labels=t$labels))
# newlabels$trow <- row(newlabels)[,1]
# newlabels <- merge(newlabels, groupdf, by.x='labels', by.y ='soilplot')
# newlabels <- merge(newlabels, torder, by='trow')
#
# grouporder <- newlabels %>% group_by(clust)  %>%  summarise(thisorder = min(torder))
# grouporder$newgroup <- order(order(grouporder$thisorder))
# newlabels <- merge(newlabels, grouporder, by='clust')
# newgroups <- newlabels$newgroup
# names(newgroups) <- newlabels$labels
# return(newgroups)
# }
# newlabels$newlabels <- paste(newlabels$clust, newlabels$newlabels)
# newlabels <- newlabels[order(newlabels$row),1]
# newtree <- t
# newtree$labels <- newlabels
if (T){
a <- 'flex'
makeplot(a,d,tbeta,k)
}
if (T){
a <- 'ward'
makeplot(a,d,tward,k)
}
if (T){
a <- 'regroup'
makeplotgroup(a,d,tward,groups)
}
source('groupplotsummary.R')
Com.Structure[order(as.numeric(as.character(Com.Structure$cluster))),c("cluster", "association", "WetStructure")]
library(soilDB)
library(aqp)#load before dplyr
library(stringr)
library(BiodiversityR)
library(cluster)
library(ape)
library(dendextend)
library(dplyr)
library(dynamicTreeCut)
library(rpart)
library(rpart.plot)
library(goeveg)
library(proxy)
library(foreign)
library(optpart)
library(dendsort)
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
# Load Veg tables ----
source('processplot.R')
#load clustering functions ----
source('clusterfunctions.R')
#group parameters ----
beta= -0.2
k = 6
d <- vegdist(plotdata, method='bray', binary=FALSE, na.rm=T)
tbeta <- d %>% flexbeta(beta= beta)
tward <- agnes(d, method = 'ward') %>% as.hclust()
t=tbeta
t=tward
t=dendsort(t)
# dk <- dynamicK(t, d)
# dkward <- dynamicK(tward, d)
# groups <- cutree(t, k = k)
# maxCoreScatter <- dk[dk$nclust %in% k,]$maxcor
# minGap <- (1 - maxCoreScatter) * 3/4
# dyngroups <-
#   cutreeDynamic(t, minClusterSize=1, method = 'hybrid', distM=as.matrix(d),deepSplit=1, maxCoreScatter=maxCoreScatter, minGap=minGap, maxAbsCoreScatter=NULL, minAbsGap=NULL)
# groups=dyngroups
groups <- cutree(t, k = k)
groups <- grouporder(t, groups)
# grouporder <- function(t,groups){
# soilplot <- names(d)
# clust <- unname(groups)
# groupdf <- as.data.frame(cbind(soilplot, clust))
# groupdf$clust <- (as.numeric(as.character(groupdf$clust)))
# torder <- as.data.frame(cbind(trow=t$order))
# torder$torder <- row(torder)[,1]
# newlabels <- as.data.frame(cbind(labels=t$labels))
# newlabels$trow <- row(newlabels)[,1]
# newlabels <- merge(newlabels, groupdf, by.x='labels', by.y ='soilplot')
# newlabels <- merge(newlabels, torder, by='trow')
#
# grouporder <- newlabels %>% group_by(clust)  %>%  summarise(thisorder = min(torder))
# grouporder$newgroup <- order(order(grouporder$thisorder))
# newlabels <- merge(newlabels, grouporder, by='clust')
# newgroups <- newlabels$newgroup
# names(newgroups) <- newlabels$labels
# return(newgroups)
# }
# newlabels$newlabels <- paste(newlabels$clust, newlabels$newlabels)
# newlabels <- newlabels[order(newlabels$row),1]
# newtree <- t
# newtree$labels <- newlabels
if (T){
a <- 'flex'
makeplot(a,d,tbeta,k)
}
if (T){
a <- 'ward'
makeplot(a,d,tward,k)
}
if (T){
a <- 'regroup'
makeplotgroup(a,d,tward,groups)
}
source('groupplotsummary.R')
Com.Structure[order(as.numeric(as.character(Com.Structure$cluster))),c("cluster", "association", "WetStructure")]
if (T){
a <- 'regroup'
makeplotgroup(a,d,t,groups)
}
source('groupplotsummary.R')
Com.Structure[order(as.numeric(as.character(Com.Structure$cluster))),c("cluster", "association", "WetStructure")]
soilplot <- names(d)
clust <- unname(groups)
groupdf <- as.data.frame(cbind(soilplot, clust))
groupdf$clust <- (as.numeric(as.character(groupdf$clust)))
torder <- as.data.frame(cbind(trow=t$order))
torder$torder <- row(torder)[,1]
newlabels <- as.data.frame(cbind(labels=t$labels))
newlabels$trow <- row(newlabels)[,1]
newlabels <- merge(newlabels, groupdf, by.x='labels', by.y ='soilplot')
newlabels <- merge(newlabels, torder, by='trow')
grouporder <- newlabels %>% group_by(clust)  %>%  summarise(thisorder = min(torder))
grouporder$newgroup <- order(order(grouporder$thisorder, decreasing=T))
newlabels <- merge(newlabels, grouporder, by='clust')
newlabels <- newlabels[order(newlabels$trow),]
newgroups <- newlabels$newgroup
names(newgroups) <- newlabels$labels
View(newlabels)
#group parameters ----
beta= -0.2
k = 4
d <- vegdist(plotdata, method='bray', binary=FALSE, na.rm=T)
tbeta <- d %>% flexbeta(beta= beta)
tward <- agnes(d, method = 'ward') %>% as.hclust()
t=tbeta
t=tward
t=dendsort(t)
# dk <- dynamicK(t, d)
# dkward <- dynamicK(tward, d)
# groups <- cutree(t, k = k)
# maxCoreScatter <- dk[dk$nclust %in% k,]$maxcor
# minGap <- (1 - maxCoreScatter) * 3/4
# dyngroups <-
#   cutreeDynamic(t, minClusterSize=1, method = 'hybrid', distM=as.matrix(d),deepSplit=1, maxCoreScatter=maxCoreScatter, minGap=minGap, maxAbsCoreScatter=NULL, minAbsGap=NULL)
# groups=dyngroups
groups <- cutree(t, k = k)
groups <- grouporder(t, groups)
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
# Load Veg tables ----
source('processplot.R')
#load clustering functions ----
source('clusterfunctions.R')
#group parameters ----
beta= -0.2
k = 4
d <- vegdist(plotdata, method='bray', binary=FALSE, na.rm=T)
tbeta <- d %>% flexbeta(beta= beta)
tward <- agnes(d, method = 'ward') %>% as.hclust()
t=tbeta
t=tward
t=dendsort(t)
# dk <- dynamicK(t, d)
# dkward <- dynamicK(tward, d)
# groups <- cutree(t, k = k)
# maxCoreScatter <- dk[dk$nclust %in% k,]$maxcor
# minGap <- (1 - maxCoreScatter) * 3/4
# dyngroups <-
#   cutreeDynamic(t, minClusterSize=1, method = 'hybrid', distM=as.matrix(d),deepSplit=1, maxCoreScatter=maxCoreScatter, minGap=minGap, maxAbsCoreScatter=NULL, minAbsGap=NULL)
# groups=dyngroups
groups <- cutree(t, k = k)
groups <- grouporder(t, groups)
# grouporder <- function(t,groups){
# soilplot <- names(d)
# clust <- unname(groups)
# groupdf <- as.data.frame(cbind(soilplot, clust))
# groupdf$clust <- (as.numeric(as.character(groupdf$clust)))
# torder <- as.data.frame(cbind(trow=t$order))
# torder$torder <- row(torder)[,1]
# newlabels <- as.data.frame(cbind(labels=t$labels))
# newlabels$trow <- row(newlabels)[,1]
# newlabels <- merge(newlabels, groupdf, by.x='labels', by.y ='soilplot')
# newlabels <- merge(newlabels, torder, by='trow')
#
# grouporder <- newlabels %>% group_by(clust)  %>%  summarise(thisorder = min(torder))
# grouporder$newgroup <- order(order(grouporder$thisorder))
# newlabels <- merge(newlabels, grouporder, by='clust')
# newgroups <- newlabels$newgroup
# names(newgroups) <- newlabels$labels
# return(newgroups)
# }
# newlabels$newlabels <- paste(newlabels$clust, newlabels$newlabels)
# newlabels <- newlabels[order(newlabels$row),1]
# newtree <- t
# newtree$labels <- newlabels
if (T){
a <- 'flex'
makeplot(a,d,tbeta,k)
}
if (T){
a <- 'ward'
makeplot(a,d,tward,k)
}
if (T){
a <- 'regroup'
makeplotgroup(a,d,t,groups)
}
source('groupplotsummary.R')
Com.Structure[order(as.numeric(as.character(Com.Structure$cluster))),c("cluster", "association", "WetStructure")]
t=tbeta
# t=tward
t=dendsort(t)
# dk <- dynamicK(t, d)
# dkward <- dynamicK(tward, d)
# groups <- cutree(t, k = k)
# maxCoreScatter <- dk[dk$nclust %in% k,]$maxcor
# minGap <- (1 - maxCoreScatter) * 3/4
# dyngroups <-
#   cutreeDynamic(t, minClusterSize=1, method = 'hybrid', distM=as.matrix(d),deepSplit=1, maxCoreScatter=maxCoreScatter, minGap=minGap, maxAbsCoreScatter=NULL, minAbsGap=NULL)
# groups=dyngroups
groups <- cutree(t, k = k)
groups <- grouporder(t, groups)
# grouporder <- function(t,groups){
# soilplot <- names(d)
# clust <- unname(groups)
# groupdf <- as.data.frame(cbind(soilplot, clust))
# groupdf$clust <- (as.numeric(as.character(groupdf$clust)))
# torder <- as.data.frame(cbind(trow=t$order))
# torder$torder <- row(torder)[,1]
# newlabels <- as.data.frame(cbind(labels=t$labels))
# newlabels$trow <- row(newlabels)[,1]
# newlabels <- merge(newlabels, groupdf, by.x='labels', by.y ='soilplot')
# newlabels <- merge(newlabels, torder, by='trow')
#
# grouporder <- newlabels %>% group_by(clust)  %>%  summarise(thisorder = min(torder))
# grouporder$newgroup <- order(order(grouporder$thisorder))
# newlabels <- merge(newlabels, grouporder, by='clust')
# newgroups <- newlabels$newgroup
# names(newgroups) <- newlabels$labels
# return(newgroups)
# }
# newlabels$newlabels <- paste(newlabels$clust, newlabels$newlabels)
# newlabels <- newlabels[order(newlabels$row),1]
# newtree <- t
# newtree$labels <- newlabels
if (T){
a <- 'flex'
makeplot(a,d,tbeta,k)
}
if (T){
a <- 'ward'
makeplot(a,d,tward,k)
}
if (T){
a <- 'regroup'
makeplotgroup(a,d,t,groups)
}
source('groupplotsummary.R')
Com.Structure[order(as.numeric(as.character(Com.Structure$cluster))),c("cluster", "association", "WetStructure")]
#group parameters ----
beta= -0.25
k = 4
d <- vegdist(plotdata, method='bray', binary=FALSE, na.rm=T)
tbeta <- d %>% flexbeta(beta= beta)
tward <- agnes(d, method = 'ward') %>% as.hclust()
t=tbeta
t=tward
t=dendsort(t)
# dk <- dynamicK(t, d)
# dkward <- dynamicK(tward, d)
# groups <- cutree(t, k = k)
# maxCoreScatter <- dk[dk$nclust %in% k,]$maxcor
# minGap <- (1 - maxCoreScatter) * 3/4
# dyngroups <-
#   cutreeDynamic(t, minClusterSize=1, method = 'hybrid', distM=as.matrix(d),deepSplit=1, maxCoreScatter=maxCoreScatter, minGap=minGap, maxAbsCoreScatter=NULL, minAbsGap=NULL)
# groups=dyngroups
groups <- cutree(t, k = k)
groups <- grouporder(t, groups)
# grouporder <- function(t,groups){
# soilplot <- names(d)
# clust <- unname(groups)
# groupdf <- as.data.frame(cbind(soilplot, clust))
# groupdf$clust <- (as.numeric(as.character(groupdf$clust)))
# torder <- as.data.frame(cbind(trow=t$order))
# torder$torder <- row(torder)[,1]
# newlabels <- as.data.frame(cbind(labels=t$labels))
# newlabels$trow <- row(newlabels)[,1]
# newlabels <- merge(newlabels, groupdf, by.x='labels', by.y ='soilplot')
# newlabels <- merge(newlabels, torder, by='trow')
#
# grouporder <- newlabels %>% group_by(clust)  %>%  summarise(thisorder = min(torder))
# grouporder$newgroup <- order(order(grouporder$thisorder))
# newlabels <- merge(newlabels, grouporder, by='clust')
# newgroups <- newlabels$newgroup
# names(newgroups) <- newlabels$labels
# return(newgroups)
# }
# newlabels$newlabels <- paste(newlabels$clust, newlabels$newlabels)
# newlabels <- newlabels[order(newlabels$row),1]
# newtree <- t
# newtree$labels <- newlabels
if (T){
a <- 'flex'
makeplot(a,d,tbeta,k)
}
if (T){
a <- 'ward'
makeplot(a,d,tward,k)
}
if (T){
a <- 'regroup'
makeplotgroup(a,d,t,groups)
}
source('groupplotsummary.R')
Com.Structure[order(as.numeric(as.character(Com.Structure$cluster))),c("cluster", "association", "WetStructure")]
soilplot <- names(d)
clust <- unname(groups)
groupdf <- as.data.frame(cbind(soilplot, clust))
groupdf$clust <- (as.numeric(as.character(groupdf$clust)))
torder <- as.data.frame(cbind(trow=t$order))
torder$torder <- row(torder)[,1]
newlabels <- as.data.frame(cbind(labels=t$labels))
newlabels$trow <- row(newlabels)[,1]
newlabels <- merge(newlabels, groupdf, by.x='labels', by.y ='soilplot')
newlabels <- merge(newlabels, torder, by='trow')
grouporder <- newlabels %>% group_by(clust)  %>%  summarise(thisorder = min(torder))
grouporder$newgroup <- order(order(grouporder$thisorder, decreasing=T))
newlabels <- merge(newlabels, grouporder, by='clust')
newlabels <- newlabels[order(newlabels$trow),]
#group parameters ----
beta= -0.25
k = 9
d <- vegdist(plotdata, method='bray', binary=FALSE, na.rm=T)
tbeta <- d %>% flexbeta(beta= beta)
tward <- agnes(d, method = 'ward') %>% as.hclust()
t=tbeta
t=tward
t=dendsort(t)
# dk <- dynamicK(t, d)
# dkward <- dynamicK(tward, d)
# groups <- cutree(t, k = k)
# maxCoreScatter <- dk[dk$nclust %in% k,]$maxcor
# minGap <- (1 - maxCoreScatter) * 3/4
# dyngroups <-
#   cutreeDynamic(t, minClusterSize=1, method = 'hybrid', distM=as.matrix(d),deepSplit=1, maxCoreScatter=maxCoreScatter, minGap=minGap, maxAbsCoreScatter=NULL, minAbsGap=NULL)
# groups=dyngroups
groups <- cutree(t, k = k)
groups <- grouporder(t, groups)
source('clusterfunctions.R')
#group parameters ----
beta= -0.25
k = 9
d <- vegdist(plotdata, method='bray', binary=FALSE, na.rm=T)
tbeta <- d %>% flexbeta(beta= beta)
tward <- agnes(d, method = 'ward') %>% as.hclust()
t=tbeta
t=tward
t=dendsort(t)
# dk <- dynamicK(t, d)
# dkward <- dynamicK(tward, d)
# groups <- cutree(t, k = k)
# maxCoreScatter <- dk[dk$nclust %in% k,]$maxcor
# minGap <- (1 - maxCoreScatter) * 3/4
# dyngroups <-
#   cutreeDynamic(t, minClusterSize=1, method = 'hybrid', distM=as.matrix(d),deepSplit=1, maxCoreScatter=maxCoreScatter, minGap=minGap, maxAbsCoreScatter=NULL, minAbsGap=NULL)
# groups=dyngroups
groups <- cutree(t, k = k)
groups <- grouporder(t, groups)
# grouporder <- function(t,groups){
# soilplot <- names(d)
# clust <- unname(groups)
# groupdf <- as.data.frame(cbind(soilplot, clust))
# groupdf$clust <- (as.numeric(as.character(groupdf$clust)))
# torder <- as.data.frame(cbind(trow=t$order))
# torder$torder <- row(torder)[,1]
# newlabels <- as.data.frame(cbind(labels=t$labels))
# newlabels$trow <- row(newlabels)[,1]
# newlabels <- merge(newlabels, groupdf, by.x='labels', by.y ='soilplot')
# newlabels <- merge(newlabels, torder, by='trow')
#
# grouporder <- newlabels %>% group_by(clust)  %>%  summarise(thisorder = min(torder))
# grouporder$newgroup <- order(order(grouporder$thisorder))
# newlabels <- merge(newlabels, grouporder, by='clust')
# newgroups <- newlabels$newgroup
# names(newgroups) <- newlabels$labels
# return(newgroups)
# }
# newlabels$newlabels <- paste(newlabels$clust, newlabels$newlabels)
# newlabels <- newlabels[order(newlabels$row),1]
# newtree <- t
# newtree$labels <- newlabels
if (T){
a <- 'flex'
makeplot(a,d,tbeta,k)
}
if (T){
a <- 'ward'
makeplot(a,d,tward,k)
}
if (T){
a <- 'regroup'
makeplotgroup(a,d,t,groups)
}
source('groupplotsummary.R')
Com.Structure[order(as.numeric(as.character(Com.Structure$cluster))),c("cluster", "association", "WetStructure")]
k = 7
d <- vegdist(plotdata, method='bray', binary=FALSE, na.rm=T)
tbeta <- d %>% flexbeta(beta= beta)
tward <- agnes(d, method = 'ward') %>% as.hclust()
t=tbeta
t=tward
t=dendsort(t)
# dk <- dynamicK(t, d)
# dkward <- dynamicK(tward, d)
# groups <- cutree(t, k = k)
# maxCoreScatter <- dk[dk$nclust %in% k,]$maxcor
# minGap <- (1 - maxCoreScatter) * 3/4
# dyngroups <-
#   cutreeDynamic(t, minClusterSize=1, method = 'hybrid', distM=as.matrix(d),deepSplit=1, maxCoreScatter=maxCoreScatter, minGap=minGap, maxAbsCoreScatter=NULL, minAbsGap=NULL)
# groups=dyngroups
groups <- cutree(t, k = k)
groups <- grouporder(t, groups)
# grouporder <- function(t,groups){
# soilplot <- names(d)
# clust <- unname(groups)
# groupdf <- as.data.frame(cbind(soilplot, clust))
# groupdf$clust <- (as.numeric(as.character(groupdf$clust)))
# torder <- as.data.frame(cbind(trow=t$order))
# torder$torder <- row(torder)[,1]
# newlabels <- as.data.frame(cbind(labels=t$labels))
# newlabels$trow <- row(newlabels)[,1]
# newlabels <- merge(newlabels, groupdf, by.x='labels', by.y ='soilplot')
# newlabels <- merge(newlabels, torder, by='trow')
#
# grouporder <- newlabels %>% group_by(clust)  %>%  summarise(thisorder = min(torder))
# grouporder$newgroup <- order(order(grouporder$thisorder))
# newlabels <- merge(newlabels, grouporder, by='clust')
# newgroups <- newlabels$newgroup
# names(newgroups) <- newlabels$labels
# return(newgroups)
# }
# newlabels$newlabels <- paste(newlabels$clust, newlabels$newlabels)
# newlabels <- newlabels[order(newlabels$row),1]
# newtree <- t
# newtree$labels <- newlabels
if (T){
a <- 'flex'
makeplot(a,d,tbeta,k)
}
if (T){
a <- 'ward'
makeplot(a,d,tward,k)
}
if (T){
a <- 'regroup'
makeplotgroup(a,d,t,groups)
}
source('groupplotsummary.R')
Com.Structure[order(as.numeric(as.character(Com.Structure$cluster))),c("cluster", "association", "WetStructure")]
